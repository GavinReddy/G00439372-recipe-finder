<!-- 
  Recipe Details Template
  Displays full recipe information:
  - Back button to return to Home
  - Ingredients with images and measurements
  - Cooking instructions
  - Add/Remove Favourites button
-->

<ion-header>
  <ion-toolbar>
    
    <!-- Back Button - Returns to Home page -->
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    
    <!-- Page Title - Shows recipe name -->
    <ion-title>{{ recipeTitle }}</ion-title>
    
  </ion-toolbar>
</ion-header>

<ion-content>
  
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner></ion-spinner>
  </div>
  
  <!-- Recipe Content - Only shows after API data loads -->
  <div *ngIf="recipeDetails">
    
    <!-- Ingredients Card -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Ingredients</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          
          <!-- Loop through each ingredient -->
          <ion-item *ngFor="let ingredient of recipeDetails.extendedIngredients">
            
            <!-- Ingredient Image -->
            <ion-img [src]="'https://spoonacular.com/cdn/ingredients_100x100/' + ingredient.image" slot="start"></ion-img>
            
            <ion-label>
              <!-- Ingredient Name/Description -->
              <h2>{{ ingredient.original }}</h2>
              <!-- Measurement based on settings -->
              <p>{{ getMeasurement(ingredient) }}</p>
            </ion-label>
            
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
    
    <!-- Instructions Card (Structured) -->
    <ion-card *ngIf="recipeDetails.analyzedInstructions && recipeDetails.analyzedInstructions.length > 0">
      <ion-card-header>
        <ion-card-title>Instructions</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list>
          <ion-item *ngFor="let instruction of recipeDetails.analyzedInstructions">
            <ion-label>
              <div *ngFor="let step of instruction.steps">
                <p><strong>{{ step.number }}:</strong> {{ step.step }}</p>
              </div>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
    
    <!-- Instructions Card (Unstructured Fallback) -->
    <ion-card *ngIf="!recipeDetails.analyzedInstructions || recipeDetails.analyzedInstructions.length === 0">
      <ion-card-header>
        <ion-card-title>Instructions</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p [innerHTML]="recipeDetails.instructions"></p>
      </ion-card-content>
    </ion-card>
    
    <!-- Favourites Button -->
    <ion-button expand="block" (click)="toggleFavourite()">
      <ion-icon [name]="isFavourite ? 'heart' : 'heart-outline'" slot="start"></ion-icon>
      {{ isFavourite ? 'REMOVE FROM FAVOURITES' : 'ADD TO FAVOURITES' }}
    </ion-button>
    
  </div>
</ion-content>